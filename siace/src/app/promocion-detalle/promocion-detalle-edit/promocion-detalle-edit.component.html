<h2>Detalle del detalle de promoción</h2>
<form
  *ngIf="promocionDetalle"
  #editForm="ngForm"
  (ngSubmit)="save()"
  autocomplete="off"
>
  <div class="row">
    <div class="col-md-12">
      <!-- Promoción Actual -->
      <mat-form-field>
        <mat-label>Promoción Actual</mat-label>
        <input
          matInput
          [(ngModel)]="promocionCurrent.pmoNombre"
          id="promocionNombre"
          name="promocionNombre"
          placeholder="Promoción"
          readonly
        />
      </mat-form-field>
    </div>
    <div class="col-md-6">
      <mat-form-field>
        <mat-label>Tipo de Promoción</mat-label>
        <mat-select
          [(ngModel)]="promocionCurrent.pmoTprId"
          name="pmoTprId"
          (selectionChange)="onPromocionIdChange($event)"
        >
          <mat-option
            *ngFor="let tipoPromocion of tipoPromocionList"
            [value]="tipoPromocion.tprId"
          >
            {{ tipoPromocion.tprNombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-md-6">
      <!-- Familia -->
      <mat-form-field>
        <mat-label>Familia</mat-label>
        <mat-select
          [value]="promocionDetalle.prdFamId"
          (selectionChange)="onFamiliaChange($event)"
        >
          <mat-option [value]="0">-- Todas las Familias --</mat-option>
          <mat-option
            *ngFor="let familia of listFamilias"
            [value]="familia.famId"
          >
            {{ familia.famNombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-md-12">
      <mat-form-field>
        <mat-label>Producto Principal</mat-label>
        <input
          type="text"
          matInput
          [formControl]="productoControl"
          [matAutocomplete]="autoProductoPrincipal"
          placeholder="Buscar producto..."
        />
        <button
          *ngIf="productoControl.value"
          matSuffix
          mat-icon-button
          aria-label="Limpiar"
          type="button"
          (click)="productoControl.reset(); onProductoClear()"
        >
          <mat-icon>close</mat-icon>
        </button>
        <mat-autocomplete
          #autoProductoPrincipal="matAutocomplete"
          [displayWith]="displayProductoFn"
          (optionSelected)="onProductoSelected($event.option.value)"
        >
          <mat-option
            *ngFor="let producto of filteredProductos | async"
            [value]="producto"
          >
            <span>
              <strong>{{ producto.proId }}</strong> - {{ producto.proNombre }}
            </span>
            <br />
            <small style="color: #666" *ngIf="producto.proDescripcion">
              {{ producto.proDescripcion }}
            </small>
          </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="promocionDetalle.prdProId == undefined">
          Producto es requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-md-6">    
      <mat-form-field>
        <mat-label>Presentación</mat-label>
        <mat-select
          [value]="promocionDetalle.prdPreId"
          (selectionChange)="onPresentacionChange($event)"
        >
          <mat-option [value]="0">-- Todas las Presentaciones --</mat-option>
          <mat-option
            *ngFor="let presentacion of listPresentaciones"
            [value]="presentacion.preId"
          >
            {{ presentacion.preNombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- COLUMNA DERECHA -->
    <div class="col-md-6">
      <!-- Producto Principal -->

      <!-- Info de productos disponibles -->
      <div style="display: flex; align-items: center; padding: 16px 0">
        <mat-hint style="font-size: 14px; color: #666">
          <mat-icon
            style="vertical-align: middle; font-size: 18px; margin-right: 8px"
          >
            info
          </mat-icon>
          Productos disponibles: {{ listProductos.length }}
        </mat-hint>
      </div>
    </div>
  </div>

  <!-- SECCIÓN DE CONFIGURACIÓN DE PROMOCIÓN -->
  <div class="row" style="margin-top: 24px">
    <div class="col-md-12">
      <h3
        style="
          margin-bottom: 16px;
          font-size: 16px;
          font-weight: 500;
          color: #666;
        "
      >
        Promoción 
      </h3>
    </div>

    <div class="col-md-12" *ngIf = "promocionCurrent.pmoTprId == 3">
      <!-- Porcentaje de Descuento -->
      <mat-form-field >
        <mat-label>Descuento directo(%)</mat-label>
        <input
          matInput
          type="number"
          [(ngModel)]="promocionDetalle.prdPorcentajeDescuento"
          id="prdProcentajeDescuento"
          name="prdProcentajeDescuento"
          placeholder="Porcentaje Descuento (%)"
        />
      </mat-form-field>
    </div>

    <div class="col-md-12">
      <!-- Productos a Comprar (NxM) -->
      <mat-form-field *ngIf = "promocionCurrent.pmoTprId == 2">
        <mat-label>Productos a Comprar (NxM)</mat-label>
        <input
          matInput
          type="number"
          [(ngModel)]="promocionDetalle.prdNxmProdCompra"
          id="prdNxmProdCompra"
          name="prdNxmProdCompra"
          placeholder="Productos a Comprar"
        />
      </mat-form-field>
    </div>

    <div class="col-md-12">
      <!-- Producto Obsequio -->
      <mat-form-field *ngIf = "promocionCurrent.pmoTprId == 1">
        <mat-label>Producto Obsequio</mat-label>
        <input
          type="text"
          matInput
          [formControl]="productoObsequioControl"
          [matAutocomplete]="autoProductoObsequio"
          placeholder="Buscar producto obsequio..."
        />
        <mat-autocomplete
          #autoProductoObsequio="matAutocomplete"
          [displayWith]="displayProductoFn"
          (optionSelected)="onProductoObsequioSelected($event.option.value)"
        >
          <mat-option
           *ngFor="let producto of filteredProductosObsequio | async" [value]="producto"
          >
            <span>
              <strong>{{ producto.proId }}</strong> - {{ producto.proNombre }}
            </span>
            <br />
            <small style="color: #666" *ngIf="producto.proDescripcion">
              {{ producto.proDescripcion }}
            </small>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>

 
  </div>

  <!-- Botones de acción -->
  <div class="button-row text-center" role="group" style="margin-top: 24px">
    <button
      type="submit"
      mat-raised-button
      color="primary"
      [disabled]="!editForm.form.valid"
    >
      Guardar
    </button>
    <button mat-button mat-dialog-close type="button">Cancelar</button>
  </div>
</form>
